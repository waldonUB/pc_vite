#!/usr/bin/env node

const path = require('path');
const spawn = require('cross-spawn');
const configPath = require.resolve('vue-cli-plugin-vite/config/index.ts');
const cwd = path.resolve(__dirname, '../');
const args = process.argv.splice(2);

function setMode() {
  const flag = args.indexOf('--mode');
  if (flag === -1) return [];
  return args.slice(flag, flag + 2);
}

const params = [
  `${process.env.BUILD ? 'build' : ''}`,
  process.env.VITE_DEBUG ? '--debug' : '',
  ...setMode(),
  '--config',
  `${configPath}`,
].filter(Boolean);

console.log(`running: vite ${params.join(' ')}`);
const serveService = spawn('vite', params, {
  cwd,
  stdio: 'inherit',
});

serveService.on('close', code => {
  process.exit(code);
});
